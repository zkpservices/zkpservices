<!DOCTYPE html>
<html>
<head>
  <title>SnarkJS Test</title>
  <script src="snarkjs.min.js"></script>
  <style>
    .input-container {
      margin-bottom: 15px;
    }
    #result {
      margin-top: 20px;
      font-weight: bold;
    }
  </style>
  <script>
    async function handleButtonClick() {
      const snarkjs = window.snarkjs;
      const input = {
        "random_number": document.getElementById("random_number").value,
        "two_factor_secret": document.getElementById("two_factor_secret").value,
        "secret_hash": document.getElementById("secret_hash").value,
      };
      const circuitWasm = "../circuits/twofactor/build/twofactor_js/twofactor.wasm";
      const circuitZkey = "../circuits/twofactor/circuit_0000.zkey";

      // Fetch the vKey JSON from the file
      const response = await fetch('../circuits/twofactor/verification_key.json');
      const vKey = await response.json();

      try {
        const {proof, publicSignals} = await snarkjs.groth16.fullProve(input, circuitWasm, circuitZkey);
        const isValid = await snarkjs.groth16.verify(vKey, publicSignals, proof);

        if (isValid) {
          document.getElementById("result").innerText = "Verification OK";
          const _pA = [proof.pi_a[0], proof.pi_a[1]];
          const _pB = [[proof.pi_b[0][1], proof.pi_b[0][0]], [proof.pi_b[1][1], proof.pi_b[1][0]]];
          const _pC = [proof.pi_c[0], proof.pi_c[1]];
          const _pubSignals = publicSignals;

          console.log("_pA:", JSON.stringify(_pA));
          console.log("_pB:", JSON.stringify(_pB));
          console.log("_pC:", JSON.stringify(_pC));
          console.log("_pubSignals:", JSON.stringify(_pubSignals));
        } else {
          document.getElementById("result").innerText = "Invalid proof";
        }
      } catch (error) {
        console.error(error);
        document.getElementById("result").innerText = "Error occurred: " + error.toString();
      }
    }
  </script>
</head>
<body>
  <div class="input-container">
    <label for="random_number">Random Number:</label><br>
    <input id="random_number" type="text">
  </div>
  <div class="input-container">
    <label for="two_factor_secret">Two Factor Secret:</label><br>
    <input id="two_factor_secret" type="text">
  </div>
  <div class="input-container">
    <label for="secret_hash">Secret Hash:</label><br>
    <input id="secret_hash" type="text">
  </div>
  <button onClick="handleButtonClick()">Run SnarkJS Test</button>
  <div id="result"></div>
</body>
</html>
